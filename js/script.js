// Generated by CoffeeScript 1.12.7
(function() {
  var Composition;

  window.Composition = Composition = (function() {
    function Composition() {
      var canvas, imageArray, random;
      this.canvasColor = '#666666';
      canvas = document.querySelector("canvas");
      this.context = canvas.getContext("2d");
      this.pivotpointList = $('.Composition_image').find('.CompositionImage_link');
      this.labelList = $('.Composition_image').find('.Label_listItem');
      this.compositionSec = $('.Component_details');
      imageArray = [
        {
          "src": "./Images/sph4.svg",
          "obj": "sph4"
        }, {
          "src": "./Images/bsph4.svg",
          "obj": "bsph4"
        }, {
          "src": "./Images/oct3.svg",
          "obj": "oct3"
        }, {
          "src": "./Images/sphi4.svg",
          "obj": "sphi4"
        }
      ];
      random = Math.floor(Math.random() * 4);
      this.imageSource = imageArray[random].src;
      this.randomObj = imageArray[random].obj;
    }

    Composition.prototype.init = function() {
      this.initialize();
      $(window).on("resize", (function(_this) {
        return function() {
          return _this.resizeCanvas();
        };
      })(this));
      $('.Label_listItem , .CompositionImage_link').on("click", (function(_this) {
        return function(e) {
          var activePoint, className, target;
          target = $(e.currentTarget);
          className = $(e.currentTarget).attr('class');
          activePoint = $(target).attr('pivotpoint');
          if (className === 'Label_listItem') {
            _this.addClass(target, _this.pivotpointList, activePoint);
          } else {
            _this.addClass(target, _this.labelList, activePoint);
          }
          _this.addDisableClass(activePoint, _this.compositionSec);
          if ($(window).width() > 900) {
            return _this.extendLineToComponentDiv(activePoint);
          }
        };
      })(this));
      return $('.CrossButton , .Component_heading h3').on('click', (function(_this) {
        return function(e) {
          var activePoint, className;
          className = $(e.currentTarget).attr('class');
          activePoint = $(e.currentTarget).parent().parent().attr('relpoint');
          if (className === 'CrossButton') {
            $(e.currentTarget).parent().parent().addClass('Component_details--disable');
            $(e.currentTarget).parent().find(".Component_wrapper").css({
              "display": "none"
            });
          } else {
            _this.addDisableClass(activePoint, _this.compositionSec);
          }
          _this.activeClassOnCrossAndHeading(activePoint, _this.labelList, className);
          _this.activeClassOnCrossAndHeading(activePoint, _this.pivotpointList, className);
          return _this.removeExtendedLine();
        };
      })(this));
    };

    Composition.prototype.addDisableClass = function(active, targetArray) {
      this.targetArray = targetArray;
      return $.each(this.targetArray, (function(_this) {
        return function(index, obj) {
          if (active === $(obj).attr('relpoint')) {
            return $(obj).removeClass("Component_details--disable");
          } else {
            return $(obj).addClass("Component_details--disable");
          }
        };
      })(this));
    };

    Composition.prototype.activeClassOnCrossAndHeading = function(active, targetArray, className) {
      this.targetArray = targetArray;
      return $.each(this.targetArray, (function(_this) {
        return function(index, obj) {
          if (active === $(obj).attr('pivotpoint')) {
            if (className === 'CrossButton') {
              return $(obj).removeClass('active');
            } else {
              return $(obj).addClass('active');
            }
          } else {
            return $(obj).removeClass('active');
          }
        };
      })(this));
    };

    Composition.prototype.addClass = function(target, targetArray, active) {
      this.targetArray = targetArray;
      $('.Label_listItem').removeClass('active');
      $('.CompositionImage_link').removeClass('active');
      return $.each(this.targetArray, (function(_this) {
        return function(index, obj) {
          if (active === $(obj).attr('pivotpoint')) {
            $(obj).addClass('active');
            return $(target).toggleClass('active');
          }
        };
      })(this));
    };

    Composition.prototype.extendLineToComponentDiv = function(activePoint) {
      return $.getJSON('JSON/data.json', (function(_this) {
        return function(data) {
          return $.each(data.pivotpoints[_this.randomObj], function(index, value) {
            var idcord, topHeight;
            idcord = data.pivotpoints[_this.randomObj][index].id.toString();
            topHeight = 25 + idcord * 40;
            if (activePoint === idcord) {
              _this.context.beginPath();
              _this.context.moveTo(500, topHeight);
              _this.context.lineTo(550, topHeight);
              _this.context.arc(550, topHeight, 5, 0, 2 * Math.PI, false);
              _this.context.fillStyle = _this.canvasColor;
              _this.context.fill();
              return _this.context.stroke();
            } else {
              return _this.context.clearRect(500, topHeight - 10, 100, 20);
            }
          });
        };
      })(this));
    };

    Composition.prototype.removeExtendedLine = function() {
      return $.getJSON('JSON/data.json', (function(_this) {
        return function(data) {
          return $.each(data.pivotpoints[_this.randomObj], function(index, value) {
            var idcord, topHeight;
            idcord = data.pivotpoints[_this.randomObj][index].id.toString();
            topHeight = 25 + idcord * 40;
            return _this.context.clearRect(500, topHeight - 10, 100, 20);
          });
        };
      })(this));
    };

    Composition.prototype.initialize = function() {
      $('.SphereImage').attr('src', this.imageSource);
      return this.resizeCanvas();
    };

    Composition.prototype.resizeCanvas = function() {
      canvas.height = 300;
      this.context.strokeStyle = this.canvasColor;
      if ($(window).width() < 900) {
        canvas.width = 300;
        return this.redraw();
      } else {
        canvas.width = 570;
        return this.redraw();
      }
    };

    Composition.prototype.redraw = function() {
      return $.getJSON('JSON/data.json', (function(_this) {
        return function(data) {
          return $.each(data.pivotpoints[_this.randomObj], function(index, value) {
            var idcord, topHeight, xcord, ycord;
            xcord = data.pivotpoints[_this.randomObj][index].x;
            ycord = data.pivotpoints[_this.randomObj][index].y;
            idcord = data.pivotpoints[_this.randomObj][index].id;
            topHeight = 25 + idcord * 40;
            $("a.CompositionImage_link[pivotpoint=" + idcord + "]").css({
              "top": ycord - 7,
              "left": xcord - 7
            });
            _this.context.beginPath();
            _this.context.moveTo(xcord, ycord);
            _this.context.lineTo(265, topHeight);
            if ($(window).width() < 900) {
              _this.context.lineTo(340, topHeight);
            } else {
              _this.context.fillStyle = _this.canvasColor;
              if (idcord === 0) {
                _this.context.lineTo(550, topHeight);
                _this.context.stroke();
                _this.context.closePath();
                _this.context.beginPath();
                _this.context.arc(550, topHeight, 5, 0, 2 * Math.PI, false);
                _this.context.fill();
              } else {
                _this.context.lineTo(500, topHeight);
              }
            }
            return _this.context.stroke();
          });
        };
      })(this));
    };

    return Composition;

  })();

  $(document).ready(function() {
    var compositionObject;
    compositionObject = new Composition();
    return compositionObject.init();
  });

}).call(this);
